{"version":3,"sources":["../../../lib/xandeum-brain.ts","../../../pages/api/geo.ts","../../../node_modules/next/src/build/templates/pages-api.ts"],"sourcesContent":["import axios from 'axios';\nimport geoip from 'geoip-lite'; \n\n// --- CONFIGURATION ---\nconst RPC_NODES = [\n  '173.212.203.145', '161.97.97.41', '192.190.136.36', '192.190.136.38',\n  '207.244.255.1', '192.190.136.28', '192.190.136.29'\n];\n\nconst TIMEOUT_RPC = 4000;\nconst TIMEOUT_CREDITS = 8000;\n\n// CORRECT API ENDPOINTS\nconst API_CREDITS_MAINNET = 'https://podcredits.xandeum.network/api/mainnet-pod-credits';\nconst API_CREDITS_DEVNET  = 'https://podcredits.xandeum.network/api/pods-credits';\n\nconst geoCache = new Map<string, { lat: number; lon: number; country: string; countryCode: string; city: string }>();\n\n// --- INTERFACES ---\nexport interface EnrichedNode {\n  address: string;\n  pubkey: string;\n  version: string;\n  uptime: number;\n  last_seen_timestamp: number;\n  is_public: boolean;\n  isUntracked?: boolean;\n  network: 'MAINNET' | 'DEVNET' | 'UNKNOWN';\n  storage_used: number;      \n  storage_committed: number; \n  credits: number | null; \n  health: number;\n  healthBreakdown: {\n      uptime: number;\n      version: number;\n      reputation: number | null;\n      storage: number;\n  };\n  location: {\n    lat: number;\n    lon: number;\n    countryName: string;\n    countryCode: string;\n    city: string;\n  };\n  rank?: number;        // REPUTATION RANK (Based on Credits) - Used for Leaderboard\n  health_rank?: number; // HEALTH RANK (Based on Vitality) - Used for Diagnostics\n}\n\n// --- HELPERS ---\n\n// STRIP suffixes: \"1.2-trynet\" -> \"1.2\", \"0.8.0-beta\" -> \"0.8.0\"\nconst cleanSemver = (v: string) => {\n  if (!v) return '0.0.0';\n  const mainVer = v.split('-')[0]; \n  return mainVer.replace(/[^0-9.]/g, '');\n};\n\nconst compareVersions = (v1: string, v2: string) => {\n  const p1 = cleanSemver(v1).split('.').map(Number);\n  const p2 = cleanSemver(v2).split('.').map(Number);\n  for (let i = 0; i < Math.max(p1.length, p2.length); i++) {\n    const n1 = p1[i] || 0;\n    const n2 = p2[i] || 0;\n    if (n1 > n2) return 1;\n    if (n1 < n2) return -1;\n  }\n  return 0;\n};\n\nconst calculateSigmoidScore = (value: number, midpoint: number, steepness: number) => \n  100 / (1 + Math.exp(-steepness * (value - midpoint)));\n\nconst calculateLogScore = (value: number, median: number, maxScore: number = 100) => {\n    if (median === 0) return value > 0 ? maxScore : 0;\n    return Math.min(maxScore, (maxScore / 2) * Math.log2((value / median) + 1));\n};\n\n// NEW: Exact Lookup Table based on v2.0 Spec (Uses CLEAN versions for distance)\nconst getVersionScoreByRank = (nodeVersion: string, consensusVersion: string, sortedCleanVersions: string[]) => {\n    const cleanNode = cleanSemver(nodeVersion);\n    const cleanConsensus = cleanSemver(consensusVersion);\n\n    // 1. If newer or same as consensus -> 100\n    if (compareVersions(cleanNode, cleanConsensus) >= 0) return 100;\n\n    // 2. Find positions in the Master List\n    const consensusIndex = sortedCleanVersions.indexOf(cleanConsensus);\n    const nodeIndex = sortedCleanVersions.indexOf(cleanNode);\n\n    // If version is unknown/weird and not in list, punish severely\n    if (nodeIndex === -1) return 0;\n\n    const distance = nodeIndex - consensusIndex;\n\n    // 3. Apply Distance Decay Table\n    if (distance <= 0) return 100; \n    if (distance === 1) return 90;\n    if (distance === 2) return 70;\n    if (distance === 3) return 50;\n    if (distance === 4) return 30;\n    if (distance === 5) return 10;\n\n    // 4. \"Death Zone\" (6+ versions behind)\n    return Math.max(0, 10 - (distance - 5));\n};\n\n// --- SCORING FACTORY ---\nconst calculateVitalityScore = (\n    storageCommitted: number, \n    storageUsed: number,\n    uptimeSeconds: number, \n    version: string, \n    consensusVersion: string, \n    sortedCleanVersions: string[], \n    medianCredits: number, \n    credits: number | null, \n    medianStorage: number\n) => {\n  // â›” Gatekeeper Rule: Hard Constraint\n  if (storageCommitted <= 0) return { total: 0, breakdown: { uptime: 0, version: 0, reputation: 0, storage: 0 } };\n\n  // 1ï¸âƒ£ Uptime Score (Sigmoid)\n  const uptimeDays = uptimeSeconds / 86400;\n  let uptimeScore = calculateSigmoidScore(uptimeDays, 7, 0.2);\n  // Cap score at 20 for nodes younger than 1 day\n  if (uptimeDays < 1) uptimeScore = Math.min(uptimeScore, 20); \n\n  // 2ï¸âƒ£ Storage Score (Logarithmic + Bonus)\n  const baseStorageScore = calculateLogScore(storageCommitted, medianStorage, 100);\n  const utilizationBonus = storageUsed > 0 ? Math.min(15, 5 * Math.log2((storageUsed / (1024 ** 3)) + 2)) : 0;\n  const totalStorageScore = baseStorageScore + utilizationBonus;\n\n  // 4ï¸âƒ£ Version Score (Distance-Based)\n  const versionScore = getVersionScoreByRank(version, consensusVersion, sortedCleanVersions);\n\n  let total = 0;\n  let reputationScore: number | null = null;\n\n  // ðŸ” Dynamic Re-Weighting Logic\n  if (credits !== null && medianCredits > 0) {\n      // 3ï¸âƒ£ Reputation Score (Standard Mode)\n      reputationScore = Math.min(100, (credits / (medianCredits * 2)) * 100);\n\n      // Standard Weights: U(35%) + S(30%) + R(20%) + V(15%)\n      total = Math.round((uptimeScore * 0.35) + (totalStorageScore * 0.30) + (reputationScore * 0.20) + (versionScore * 0.15));\n  } else {\n      // Fallback Weights: U(45%) + S(35%) + V(20%)\n      total = Math.round((uptimeScore * 0.45) + (totalStorageScore * 0.35) + (versionScore * 0.20));\n      reputationScore = null; \n  }\n\n  return {\n      total: Math.max(0, Math.min(100, total)),\n      breakdown: {\n          uptime: Math.round(uptimeScore),\n          version: Math.round(versionScore),\n          reputation: reputationScore,\n          storage: Math.round(totalStorageScore)\n      }\n  };\n};\n\n// --- FETCHING ---\nconst AXIOS_CONFIG = {\n    timeout: TIMEOUT_CREDITS,\n    headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n        'Accept': 'application/json, text/plain, */*'\n    }\n};\n\nasync function fetchRawData() {\n  const payload = { jsonrpc: '2.0', method: 'get-pods-with-stats', params: [], id: 1 };\n  try {\n      const res = await axios.post(`http://${RPC_NODES[0]}:6000/rpc`, payload, { timeout: TIMEOUT_RPC });\n      if (res.data?.result?.pods) return res.data.result.pods;\n  } catch (e) { /* fallthrough */ }\n\n  const shuffled = RPC_NODES.slice(1).sort(() => 0.5 - Math.random()).slice(0, 3);\n  try {\n      const winner = await Promise.any(shuffled.map(ip => \n          axios.post(`http://${ip}:6000/rpc`, payload, { timeout: TIMEOUT_RPC })\n               .then(r => r.data?.result?.pods || [])\n      ));\n      return winner;\n  } catch (e) { return []; }\n}\n\nasync function fetchCredits() {\n    const [mainnetRes, devnetRes] = await Promise.allSettled([\n        axios.get(API_CREDITS_MAINNET, AXIOS_CONFIG),\n        axios.get(API_CREDITS_DEVNET, AXIOS_CONFIG)\n    ]);\n    const parseData = (res: PromiseSettledResult<any>) => {\n        if (res.status !== 'fulfilled') return [];\n        const d = res.value.data;\n        if (d?.pods_credits && Array.isArray(d.pods_credits)) return d.pods_credits;\n        if (Array.isArray(d)) return d;\n        return [];\n    };\n    return {\n        mainnet: parseData(mainnetRes),\n        devnet: parseData(devnetRes)\n    };\n}\n\nasync function resolveLocations(ips: string[]) {\n  const missing = ips.filter(ip => !geoCache.has(ip));\n  if (missing.length > 0) {\n    try {\n      for (let i = 0; i < missing.length; i += 100) {\n        const chunk = missing.slice(i, i + 100);\n        const res = await axios.post('http://ip-api.com/batch', chunk.map(ip => ({ query: ip, fields: \"lat,lon,country,countryCode,city,query\" })), { timeout: 3000 });\n        res.data.forEach((d: any) => {\n          if (d.lat && d.lon) geoCache.set(d.query, { lat: d.lat, lon: d.lon, country: d.country, countryCode: d.countryCode, city: d.city });\n        });\n      }\n    } catch (e) { /* API Fail */ }\n    missing.forEach(ip => {\n      if (!geoCache.has(ip)) {\n        const geo = geoip.lookup(ip);\n        if (geo) geoCache.set(ip, { lat: geo.ll[0], lon: geo.ll[1], country: new Intl.DisplayNames(['en'], { type: 'region' }).of(geo.country) || geo.country, countryCode: geo.country, city: geo.city || 'Unknown Node' });\n        else geoCache.set(ip, { lat: 0, lon: 0, country: 'Private Network', countryCode: 'XX', city: 'Hidden' });\n      }\n    });\n  }\n}\n\n// --- MAIN EXPORT ---\n\nexport async function getNetworkPulse(): Promise<{ nodes: EnrichedNode[], stats: any }> {\n  const [rawPods, creditsData] = await Promise.all([ fetchRawData(), fetchCredits() ]);\n  if (!rawPods || rawPods.length === 0) throw new Error(\"Network Unreachable\");\n\n  const mainnetMap = new Map<string, number>();\n  const devnetMap = new Map<string, number>();\n  const mainnetValues: number[] = [];\n  const devnetValues: number[] = [];\n\n  // Populate Mainnet\n  if (Array.isArray(creditsData.mainnet)) {\n      creditsData.mainnet.forEach((c: any) => {\n          const val = parseFloat(c.credits || c.amount || '0');\n          const key = c.pod_id || c.pubkey || c.node;\n          if (key && !isNaN(val)) { mainnetMap.set(key, val); mainnetValues.push(val); }\n      });\n  }\n\n  // Populate Devnet\n  if (Array.isArray(creditsData.devnet)) {\n      creditsData.devnet.forEach((c: any) => {\n          const val = parseFloat(c.credits || c.amount || '0');\n          const key = c.pod_id || c.pubkey || c.node;\n          if (key && !isNaN(val)) { devnetMap.set(key, val); devnetValues.push(val); }\n      });\n  }\n\n  mainnetValues.sort((a, b) => a - b);\n  devnetValues.sort((a, b) => a - b);\n  const medianMainnet = mainnetValues.length ? mainnetValues[Math.floor(mainnetValues.length / 2)] : 0;\n  const medianDevnet = devnetValues.length ? devnetValues[Math.floor(devnetValues.length / 2)] : 0;\n\n  const storageArray: number[] = rawPods.map((p: any) => Number(p.storage_committed) || 0).sort((a: number, b: number) => a - b);\n  const medianStorage = storageArray.length ? storageArray[Math.floor(storageArray.length / 2)] : 1;\n\n  // --- VERSION CONSENSUS LOGIC (TWO-TRACK STRATEGY) ---\n  const rawVersionCounts: Record<string, number> = {}; \n  const uniqueCleanVersionsSet = new Set<string>();\n\n  rawPods.forEach((p: any) => { \n      const rawV = (p.version || '0.0.0'); \n      const cleanV = cleanSemver(rawV);\n      \n      // Track 1: Vote using EXACT RAW string (Strict Mode Consensus)\n      rawVersionCounts[rawV] = (rawVersionCounts[rawV] || 0) + 1;\n      \n      // Track 2: Build the simplified ladder (Semantic Ranking)\n      uniqueCleanVersionsSet.add(cleanV);\n  });\n\n  // Consensus is the most common RAW version\n  const consensusVersion = Object.keys(rawVersionCounts).sort((a, b) => rawVersionCounts[b] - rawVersionCounts[a])[0] || '0.0.0';\n\n  // Master List sorted Descending\n  const sortedCleanVersions = Array.from(uniqueCleanVersionsSet).sort((a, b) => compareVersions(b, a));\n\n  await resolveLocations([...new Set(rawPods.map((p: any) => p.address.split(':')[0]))] as string[]);\n\n  const expandedNodes: EnrichedNode[] = [];\n\n  const scoreNode = (pod: any, network: 'MAINNET' | 'DEVNET' | 'UNKNOWN', credits: number | null, medianCredits: number, isUntracked: boolean) => {\n      const ip = pod.address.split(':')[0];\n      const loc = geoCache.get(ip) || { lat: 0, lon: 0, country: 'Unknown', countryCode: 'XX', city: 'Unknown' };\n      const storageCommitted = Number(pod.storage_committed) || 0;\n      const storageUsed = Number(pod.storage_used) || 0;\n      const uptime = Number(pod.uptime) || 0;\n\n      const vitality = calculateVitalityScore(\n          storageCommitted, storageUsed, uptime, \n          pod.version || '0.0.0', consensusVersion, sortedCleanVersions, \n          medianCredits, credits, medianStorage\n      );\n\n      return {\n          ...pod,\n          pubkey: pod.pubkey || pod.public_key,\n          network, \n          storage_committed: storageCommitted, \n          storage_used: storageUsed,           \n          credits, \n          isUntracked,\n          health: vitality.total,\n          healthBreakdown: vitality.breakdown, \n          location: { \n              lat: loc.lat, lon: loc.lon, countryName: loc.country, countryCode: loc.countryCode, city: loc.city \n          }\n      };\n  };\n\n  rawPods.forEach((pod: any) => {\n      const key = pod.pubkey || pod.public_key;\n      const inMainnet = mainnetMap.has(key);\n      const inDevnet = devnetMap.has(key);\n\n      if (inMainnet) {\n          const credits = mainnetMap.get(key) || 0;\n          expandedNodes.push(scoreNode(pod, 'MAINNET', credits, medianMainnet, false));\n      }\n\n      if (inDevnet) {\n          const credits = devnetMap.get(key) || 0;\n          expandedNodes.push(scoreNode(pod, 'DEVNET', credits, medianDevnet, false));\n      }\n\n      if (!inMainnet && !inDevnet) {\n          const isUntracked = creditsData.mainnet.length > 0;\n          expandedNodes.push(scoreNode(pod, 'UNKNOWN', null, medianMainnet, isUntracked));\n      }\n  });\n\n  // --- REPUTATION RANKING (Original Logic) ---\n  const mainnetNodes = expandedNodes.filter(n => n.network === 'MAINNET').sort((a, b) => (b.credits || 0) - (a.credits || 0));\n  const devnetNodes = expandedNodes.filter(n => n.network === 'DEVNET').sort((a, b) => (b.credits || 0) - (a.credits || 0));\n  const unknownNodes = expandedNodes.filter(n => n.network === 'UNKNOWN');\n\n  let r = 1;\n  mainnetNodes.forEach((n, i) => { if (i > 0 && (n.credits || 0) < (mainnetNodes[i-1].credits || 0)) r = i + 1; n.rank = r; });\n\n  r = 1;\n  devnetNodes.forEach((n, i) => { if (i > 0 && (n.credits || 0) < (devnetNodes[i-1].credits || 0)) r = i + 1; n.rank = r; });\n\n  const finalNodes = [...mainnetNodes, ...devnetNodes, ...unknownNodes];\n\n  // --- HEALTH RANKING (New Logic) ---\n  // Rank the entire network based on health score, independent of network type\n  const healthSorted = [...finalNodes].sort((a, b) => b.health - a.health);\n  let hr = 1;\n  healthSorted.forEach((n, i) => {\n      // If health matches previous node, share the rank\n      if (i > 0 && n.health < healthSorted[i-1].health) {\n          hr = i + 1;\n      }\n      n.health_rank = hr;\n  });\n\n  // CALCULATE REAL AVERAGES FOR BREAKDOWN\n  let totalUptime = 0;\n  let totalVersion = 0;\n  let totalReputation = 0;\n  let reputationCount = 0;\n  let totalStorage = 0;\n\n  finalNodes.forEach(node => {\n    totalUptime += node.healthBreakdown.uptime;\n    totalVersion += node.healthBreakdown.version;\n    totalStorage += node.healthBreakdown.storage;\n\n    if (node.healthBreakdown.reputation !== null) {\n      totalReputation += node.healthBreakdown.reputation;\n      reputationCount++;\n    }\n  });\n\n  const nodeCount = finalNodes.length || 1;\n  const avgHealth = Math.round(finalNodes.reduce((a, b) => a + b.health, 0) / nodeCount);\n\n  return { \n    nodes: finalNodes, \n    stats: { \n        consensusVersion, \n        medianCredits: medianMainnet, \n        medianStorage,\n        totalNodes: finalNodes.length,\n        systemStatus: {\n            credits: creditsData.mainnet.length > 0 || creditsData.devnet.length > 0, \n            rpc: true \n        },\n        avgBreakdown: {\n            total: avgHealth,\n            uptime: Math.round(totalUptime / nodeCount),\n            version: Math.round(totalVersion / nodeCount),\n            reputation: reputationCount > 0 ? Math.round(totalReputation / reputationCount) : null,\n            storage: Math.round(totalStorage / nodeCount)\n        }\n    } \n  };\n}\n","import type { NextApiRequest, NextApiResponse } from 'next';\nimport { getNetworkPulse } from '../../lib/xandeum-brain';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\n\n  try {\n    const { nodes, stats } = await getNetworkPulse();\n\n    const cityMap = new Map<string, any>();\n\n    nodes.forEach(node => {\n      const { city, countryName, countryCode, lat, lon } = node.location;\n      if (lat === 0 && lon === 0) return; \n\n      const key = `${city}-${countryName}`;\n      const storageGB = (node.storage_committed || 0) / (1024 ** 3);\n      const network = node.network || 'UNKNOWN';\n      const hasCredits = node.credits !== null; // Check if this specific node has data\n\n      if (cityMap.has(key)) {\n        const existing = cityMap.get(key);\n        existing.count++;\n        existing.totalStorage += storageGB;\n\n        if (hasCredits) {\n            existing.totalCredits += node.credits;\n            existing.hasValidCreditData = true;\n        }\n\n        existing.healthSum += node.health;\n        existing.totalUptime += (node.uptime || 0);\n        if (node.is_public) existing.publicCount++;\n\n        existing.ips.push(node.address.split(':')[0]);\n\n        // --- TRACKING KINGS ---\n        if (storageGB > existing.bestNodes.storageVal) {\n            existing.bestNodes.storageVal = storageGB;\n            existing.bestNodes.storagePk = node.pubkey;\n            existing.bestNodes.storageNet = network;\n        }\n\n        // Only update Credit King if this node actually has credits\n        // OR if the existing king has 0 and we want to overwrite (though usually null < 0 is false)\n        if (hasCredits && (node.credits || 0) >= existing.bestNodes.creditsVal) {\n            existing.bestNodes.creditsVal = node.credits;\n            existing.bestNodes.creditsPk = node.pubkey;\n            existing.bestNodes.creditsNet = network;\n            existing.bestNodes.creditsUntracked = false; // Mark as tracked\n        }\n\n        if (node.health > existing.bestNodes.healthVal) {\n            existing.bestNodes.healthVal = node.health;\n            existing.bestNodes.healthPk = node.pubkey;\n            existing.bestNodes.healthUptime = node.uptime || 0;\n            existing.bestNodes.healthNet = network;\n        }\n\n      } else {\n        cityMap.set(key, {\n          name: city,\n          country: countryName,\n          countryCode: countryCode,\n          lat, lon,\n          count: 1,\n          totalStorage: storageGB,\n          totalCredits: node.credits || 0, \n          hasValidCreditData: hasCredits, \n          healthSum: node.health,\n          totalUptime: node.uptime || 0,\n          publicCount: node.is_public ? 1 : 0,\n          ips: [node.address.split(':')[0]],\n\n          // Initial Best Nodes\n          bestNodes: {\n              storageVal: storageGB, storagePk: node.pubkey, storageNet: network,\n              \n              // Credits King Init\n              creditsVal: node.credits || 0, \n              creditsPk: node.pubkey, \n              creditsNet: network,\n              creditsUntracked: !hasCredits, // Mark untracked if initial node is null\n\n              healthVal: node.health, healthPk: node.pubkey, healthUptime: node.uptime || 0, healthNet: network\n          }\n        });\n      }\n    });\n\n    const locations = Array.from(cityMap.values()).map(l => {\n        const finalCredits = l.hasValidCreditData ? l.totalCredits : null;\n\n        return {\n          name: l.name,\n          country: l.country,\n          countryCode: l.countryCode,\n          lat: l.lat,\n          lon: l.lon,\n          count: l.count,\n          totalStorage: l.totalStorage,\n          totalCredits: finalCredits,\n          avgHealth: Math.round(l.healthSum / l.count),\n          avgUptime: l.totalUptime / l.count,\n          publicRatio: (l.publicCount / l.count) * 100,\n          ips: l.ips,\n\n          topPerformers: {\n              STORAGE: { pk: l.bestNodes.storagePk, val: l.bestNodes.storageVal, network: l.bestNodes.storageNet },\n              // Pass the isUntracked flag for credits\n              CREDITS: { \n                  pk: l.bestNodes.creditsPk, \n                  val: l.bestNodes.creditsVal, \n                  network: l.bestNodes.creditsNet,\n                  isUntracked: l.bestNodes.creditsUntracked \n              },\n              HEALTH:  { pk: l.bestNodes.healthPk, val: l.bestNodes.healthVal, subVal: l.bestNodes.healthUptime, network: l.bestNodes.healthNet }\n          }\n        };\n    });\n\n    const topRegion = [...locations].sort((a, b) => b.totalStorage - a.totalStorage)[0];\n\n    res.status(200).json({\n      locations,\n      stats: {\n        totalNodes: stats.totalNodes,\n        countries: new Set(locations.map(l => l.country)).size,\n        topRegion: topRegion ? topRegion.name : 'Global',\n        topRegionMetric: topRegion ? topRegion.totalStorage : 0\n      }\n    });\n\n  } catch (error) {\n    res.status(500).json({ error: 'Geo System Offline' });\n  }\n}\n","import type { NextApiResponse } from '../../types'\nimport type { IncomingMessage, ServerResponse } from 'node:http'\n\nimport { sendError } from '../../server/api-utils'\nimport { RouteKind } from '../../server/route-kind'\nimport type { Span } from '../../server/lib/trace/tracer'\nimport { PagesAPIRouteModule } from '../../server/route-modules/pages-api/module.compiled'\n\nimport { hoist } from './helpers'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\nimport { getTracer, SpanKind } from '../../server/lib/trace/tracer'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport type { InstrumentationOnRequestError } from '../../server/instrumentation/types'\nimport { addRequestMeta } from '../../server/request-meta'\n\n// Re-export the handler (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export config.\nexport const config = hoist(userland, 'config')\n\n// Create and export the route module that will be consumed.\nconst routeModule = new PagesAPIRouteModule({\n  definition: {\n    kind: RouteKind.PAGES_API,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  userland,\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n})\n\nexport async function handler(\n  req: IncomingMessage,\n  res: ServerResponse,\n  ctx: {\n    waitUntil?: (prom: Promise<void>) => void\n  }\n): Promise<void> {\n  if (routeModule.isDev) {\n    addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n  }\n  let srcPage = 'VAR_DEFINITION_PAGE'\n\n  // turbopack doesn't normalize `/index` in the page name\n  // so we need to to process dynamic routes properly\n  // TODO: fix turbopack providing differing value from webpack\n  if (process.env.TURBOPACK) {\n    srcPage = srcPage.replace(/\\/index$/, '') || '/'\n  }\n\n  const prepareResult = await routeModule.prepare(req, res, { srcPage })\n\n  if (!prepareResult) {\n    res.statusCode = 400\n    res.end('Bad Request')\n    ctx.waitUntil?.(Promise.resolve())\n    return\n  }\n\n  const { query, params, prerenderManifest, routerServerContext } =\n    prepareResult\n\n  try {\n    const method = req.method || 'GET'\n    const tracer = getTracer()\n\n    const activeSpan = tracer.getActiveScopeSpan()\n    const onRequestError =\n      routeModule.instrumentationOnRequestError.bind(routeModule)\n\n    const invokeRouteModule = async (span?: Span) =>\n      routeModule\n        .render(req, res, {\n          query: {\n            ...query,\n            ...params,\n          },\n          params,\n          allowedRevalidateHeaderKeys: process.env\n            .__NEXT_ALLOWED_REVALIDATE_HEADERS as any as string[],\n          multiZoneDraftMode: Boolean(process.env.__NEXT_MULTI_ZONE_DRAFT_MODE),\n          trustHostHeader: process.env\n            .__NEXT_TRUST_HOST_HEADER as any as boolean,\n          // TODO: get this from from runtime env so manifest\n          // doesn't need to load\n          previewProps: prerenderManifest.preview,\n          propagateError: false,\n          dev: routeModule.isDev,\n          page: 'VAR_DEFINITION_PAGE',\n\n          internalRevalidate: routerServerContext?.revalidate,\n\n          onError: (...args: Parameters<InstrumentationOnRequestError>) =>\n            onRequestError(req, ...args),\n        })\n        .finally(() => {\n          if (!span) return\n\n          span.setAttributes({\n            'http.status_code': res.statusCode,\n            'next.rsc': false,\n          })\n\n          const rootSpanAttributes = tracer.getRootSpanAttributes()\n          // We were unable to get attributes, probably OTEL is not enabled\n          if (!rootSpanAttributes) {\n            return\n          }\n\n          if (\n            rootSpanAttributes.get('next.span_type') !==\n            BaseServerSpan.handleRequest\n          ) {\n            console.warn(\n              `Unexpected root span type '${rootSpanAttributes.get(\n                'next.span_type'\n              )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n            )\n            return\n          }\n\n          const route = rootSpanAttributes.get('next.route')\n          if (route) {\n            const name = `${method} ${route}`\n\n            span.setAttributes({\n              'next.route': route,\n              'http.route': route,\n              'next.span_name': name,\n            })\n            span.updateName(name)\n          } else {\n            span.updateName(`${method} ${srcPage}`)\n          }\n        })\n\n    // TODO: activeSpan code path is for when wrapped by\n    // next-server can be removed when this is no longer used\n    if (activeSpan) {\n      await invokeRouteModule(activeSpan)\n    } else {\n      await tracer.withPropagatedContext(req.headers, () =>\n        tracer.trace(\n          BaseServerSpan.handleRequest,\n          {\n            spanName: `${method} ${srcPage}`,\n            kind: SpanKind.SERVER,\n            attributes: {\n              'http.method': method,\n              'http.target': req.url,\n            },\n          },\n          invokeRouteModule\n        )\n      )\n    }\n  } catch (err) {\n    // we re-throw in dev to show the error overlay\n    if (routeModule.isDev) {\n      throw err\n    }\n    // this is technically an invariant as error handling\n    // should be done inside of api-resolver onError\n    sendError(res as NextApiResponse, 500, 'Internal Server Error')\n  } finally {\n    // We don't allow any waitUntil work in pages API routes currently\n    // so if callback is present return with resolved promise since no\n    // pending work\n    ctx.waitUntil?.(Promise.resolve())\n  }\n}\n"],"names":["sendError","RouteKind","PagesAPIRouteModule","hoist","userland","getTracer","SpanKind","BaseServerSpan","addRequestMeta","config","routeModule","definition","kind","PAGES_API","page","pathname","bundlePath","filename","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","handler","req","res","ctx","isDev","hrtime","bigint","srcPage","TURBOPACK","replace","prepareResult","prepare","statusCode","end","waitUntil","Promise","resolve","query","params","prerenderManifest","routerServerContext","method","tracer","activeSpan","getActiveScopeSpan","onRequestError","instrumentationOnRequestError","bind","invokeRouteModule","span","render","allowedRevalidateHeaderKeys","__NEXT_ALLOWED_REVALIDATE_HEADERS","multiZoneDraftMode","Boolean","__NEXT_MULTI_ZONE_DRAFT_MODE","trustHostHeader","__NEXT_TRUST_HOST_HEADER","previewProps","preview","propagateError","dev","internalRevalidate","revalidate","onError","args","finally","setAttributes","rootSpanAttributes","getRootSpanAttributes","get","handleRequest","console","warn","route","name","updateName","withPropagatedContext","headers","trace","spanName","SERVER","attributes","url","err"],"mappings":"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","ignoreList":[2]}